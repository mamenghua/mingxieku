"use strict";$(function(){function t(){}function a(){var e=0,n=0;$("#cart_list_table").find("input[type='checkbox']").each(function(t){$(this).prop("checked")&&(e+=parseInt($(".num").eq(t).val()),n+=parseInt($(".perPrice").eq(t).text()))}),$(".totalNum").text(e),$(".totalPri").text(n)}t.prototype.showList=function(){console.log($.cookie("token")),$cartList=$("#cart_list_table"),$checkAll=$("#checkAll"),$.ajax({type:"get",url:"http://47.104.244.134:8080/cartlist.do",data:{token:$.cookie("token")},success:function(t){var e="";for(var n in t){var i=t[n];console.log(i),e+="<tr id="+i.id+" gid="+i.gid+'>\n\t\t\t\t\t\t\t<td><input type="checkbox" /></td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<a href="detail.html?id='+i.goods.id+'">\n\t\t\t\t\t\t\t\t\t<img src="'+i.goods.picurl+'" width="50" height="50"/>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<h3 class="tit">'+i.goods.name+'</h3>\n\t\t\t\t\t\t\t\t<i>( 尺码:39,颜色:白色+灰色 )</i>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>0</td>\n\t\t\t\t\t\t\t<td>￥<i class="price">'+i.goods.price+'</i>.00</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<span class="numdec"></span>\n\t\t\t\t\t\t\t\t<input type="text" class="num" value="'+i.count+'"/>\n\t\t\t\t\t\t\t\t<span class="numadd"></span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>-</td>\n\t\t\t\t\t\t\t<td>￥<i class="perPrice">'+i.goods.price*i.count+'</i>.00</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<a class="delBtn" href="javascript:void(0);">删除</a>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>'}$("#cart_list_table").html(e),$checkAll.click(function(){$("#cart_list_table input").prop("checked",$(this).prop("checked")),a()}),$("#cart_list_table").find("input[type='checkbox']").click(function(){$("#cart_list_table input:checked").length==$("#cart_list_table tr").length?$checkAll.prop("checked",!0):$checkAll.prop("checked",!1),a()}),$(".numadd").each(function(t){$(this).on("click",function(){var t=$(this).parents("tr").attr("id"),e=$(this).parents("tr").attr("gid");$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:t,gid:e,num:1,token:$.cookie("token")},success:function(t){console.log("按钮加"),console.log(t)}});var n=parseInt($(this).prev().val())+1;$(this).prev().val(n),$(this).parents("tr").find(".perPrice").text(n*$(this).parents("tr").find(".price").text()),a()})}),$(".numdec").each(function(t){$(this).on("click",function(){var t=parseInt($(this).next().val())-1;t<1?(t=1,$(this).val(t)):$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:$(this).parents("tr").attr("id"),gid:$(this).parents("tr").attr("gid"),num:-1,token:$.cookie("token")},success:function(t){console.log(t)}}),$(this).next().val(t),$(this).parents("tr").find(".perPrice").text(t*$(this).parents("tr").find(".price").text()),a()})}),$(".num").each(function(){var i=0,c=0;$(this).on("input",function(){console.log("正则验证,只能输入数字");var t=$(this).val();t=t.replace(/\D/g,""),$(this).val(t)}),$(this).focus(function(){i=$(this).val()}),$(this).blur(function(){(c=parseInt($(this).val()))<1&&(c=1,$(this).val(c));var t=c-i;console.log(i,c,t);var e=$(this).parents("tr").attr("id"),n=$(this).parents("tr").attr("gid");console.log(e,n),0!=t&&$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:e,gid:n,num:t,token:$.cookie("token")},success:function(t){console.log("文本框改变"),console.log(t)}}),$(this).parents("tr").find(".perPrice").text(c*$(this).parents("tr").find(".price").text()),a()})}),$(".delBtn").each(function(){$(this).on("click",function(){$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",data:{id:$(this).parents("tr").attr("id"),gid:$(this).parents("tr").attr("gid"),num:0,token:$.cookie("token")},success:function(t){console.log(t)}}),$(this).parents("tr").remove(),a()})})}})},(new t).showList()});